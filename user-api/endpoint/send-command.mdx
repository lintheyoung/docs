---
title: '发送命令（旧版）'
api: 'POST /send-command'
---

<Warning>
**已废弃**: 此接口已被 `/user-device-control` 取代。建议新项目使用新接口，获得更好的参数验证和错误处理。
</Warning>

## 接口说明

旧版设备控制接口，功能与 `/user-device-control` 相同，但参数结构略有不同。

为保持向后兼容，此接口仍然可用，但不再维护新功能。

## 请求参数

<ParamField body="thing_name" type="string" required>
  AWS IoT Thing名称
</ParamField>

<ParamField body="action" type="string" required>
  动作类型（与新接口的 `command` 字段功能相同）
</ParamField>

<ParamField body="payload" type="object" required>
  命令负载（与新接口的 `params` 字段功能相同）
</ParamField>

## 响应数据

<ResponseField name="success" type="boolean">
  操作是否成功
</ResponseField>

<ResponseField name="request_id" type="string">
  请求ID（字段名与新接口的 `reqId` 不同）
</ResponseField>

## 错误码

与 `/user-device-control` 相同。

<RequestExample>
```bash cURL
curl -X POST \
  'https://your-supabase-project.supabase.co/functions/v1/send-command' \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "thing_name": "RT4G:001",
    "action": "setMode",
    "payload": {
      "mode": "auto"
    }
  }'
```

```javascript Node.js
const response = await fetch(
  'https://your-supabase-project.supabase.co/functions/v1/send-command',
  {
    method: 'POST',
    headers: {
      'Authorization': 'Bearer YOUR_JWT_TOKEN',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      thing_name: 'RT4G:001',
      action: 'setMode',
      payload: {
        mode: 'auto'
      }
    })
  }
);
```
</RequestExample>

<ResponseExample>
```json 成功响应
{
  "success": true,
  "request_id": "cmd_1703002800123_abc456"
}
```
</ResponseExample>

## 迁移指南

### 新旧接口对比

| 字段 | 旧接口 `/send-command` | 新接口 `/user-device-control` |
|------|------------------------|------------------------------|
| 命令字段名 | `action` | `command` |
| 参数字段名 | `payload` | `params` |
| 响应ID字段 | `request_id` | `reqId` |
| 子设备支持 | ❌ 不支持 | ✅ 支持 `shadow_name` |
| 参数验证 | ⚠️ 基础验证 | ✅ 严格验证 |

### 迁移步骤

<Steps>
  <Step title="1. 更新API端点">
    将 `/send-command` 改为 `/user-device-control`
  </Step>

  <Step title="2. 重命名字段">
    - `action` → `command`
    - `payload` → `params`
    - `request_id` → `reqId`
  </Step>

  <Step title="3. 测试验证">
    新接口参数验证更严格，确保参数符合规范
  </Step>

  <Step title="4. 更新错误处理">
    新接口返回更详细的错误信息
  </Step>
</Steps>

### 迁移示例

```javascript
// 旧接口
const oldApiCall = {
  thing_name: 'RT4G:001',
  action: 'setMode',        // ← action
  payload: {                // ← payload
    mode: 'auto'
  }
};

// 新接口
const newApiCall = {
  thing_name: 'RT4G:001',
  command: 'setMode',       // ← command
  params: {                 // ← params
    mode: 'auto'
  }
};

// 响应字段也不同
const oldResponse = { request_id: '...' };  // ← request_id
const newResponse = { reqId: '...' };       // ← reqId
```

<Note>
**兼容性**: 旧接口将在2025年Q2停止维护，请尽快迁移到新接口。
</Note>

## 使用说明

### 为什么要迁移？

<CardGroup cols={2}>
  <Card title="更好的参数验证" icon="check">
    新接口对命令参数进行严格验证，减少设备执行错误
  </Card>

  <Card title="支持子设备控制" icon="sitemap">
    新接口支持通过 `shadow_name` 控制网关下的子设备
  </Card>

  <Card title="统一的错误格式" icon="triangle-exclamation">
    新接口返回结构化的错误信息，便于调试
  </Card>

  <Card title="更详细的文档" icon="book">
    新接口有完整的命令参考和示例
  </Card>
</CardGroup>

### 兼容模式

如果暂时无法迁移，可以使用适配器模式：

```javascript
// 适配器函数
function adaptToNewApi(oldParams) {
  return {
    thing_name: oldParams.thing_name,
    command: oldParams.action,     // action → command
    params: oldParams.payload      // payload → params
  };
}

// 使用旧参数调用新接口
const oldStyleParams = {
  thing_name: 'RT4G:001',
  action: 'setMode',
  payload: { mode: 'auto' }
};

const newStyleParams = adaptToNewApi(oldStyleParams);

await fetch('/user-device-control', {
  method: 'POST',
  headers: { 'Authorization': `Bearer ${token}` },
  body: JSON.stringify(newStyleParams)
});
```

<Warning>
**停止维护时间表**:
- 2025 Q1: 旧接口正常可用，但显示废弃警告
- 2025 Q2: 旧接口停止维护，仅修复严重安全问题
- 2025 Q3: 旧接口可能下线

请尽快完成迁移！
</Warning>
