---
title: "RAG çŸ¥è¯†é—®ç­”ç³»ç»Ÿ"
---

## æ¦‚è¿°

RAG (Retrieval-Augmented Generation) çŸ¥è¯†é—®ç­”ç³»ç»Ÿæ˜¯é›†æˆåœ¨ Crisp å®¢æœç³»ç»Ÿä¸­çš„æ™ºèƒ½é—®ç­”åŠŸèƒ½ï¼Œèƒ½å¤Ÿæ ¹æ®ç”¨æˆ·çš„é—®é¢˜è‡ªåŠ¨ä»çŸ¥è¯†åº“ä¸­æ£€ç´¢ç›¸å…³å†…å®¹å¹¶ç”Ÿæˆå›ç­”ã€‚

**æ ¸å¿ƒèƒ½åŠ›**ï¼š
- ğŸ” **è¯­ä¹‰æ£€ç´¢**ï¼šåŸºäºå‘é‡ç›¸ä¼¼åº¦çš„æ™ºèƒ½çŸ¥è¯†åŒ¹é…
- ğŸŒ **å¤šè¯­è¨€æ”¯æŒ**ï¼šè‡ªåŠ¨è¯†åˆ«ç”¨æˆ·è¯­è¨€ï¼Œè¿”å›å¯¹åº”è¯­è¨€çš„çŸ¥è¯†
- ğŸ–¼ï¸ **å›¾ç‰‡è¿”å›**ï¼šæ”¯æŒè¿”å›äº§å“å›¾ç‰‡ã€ç¤ºæ„å›¾ç­‰å¯è§†åŒ–å†…å®¹
- ğŸ“š **å¼•ç”¨è¿½æº¯**ï¼šå›ç­”é™„å¸¦çŸ¥è¯†æ¥æºé“¾æ¥ï¼Œæ”¯æŒæ·±åº¦é˜…è¯»
- ğŸ” **æƒé™æ§åˆ¶**ï¼šæ”¯æŒå…¬å¼€/å†…éƒ¨/ç§æœ‰ä¸‰çº§è®¿é—®æ§åˆ¶
- ğŸ’¬ **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**ï¼šè®°å¿†ä¼šè¯å†å²ï¼Œæ”¯æŒå¤šè½®å¯¹è¯

## ç³»ç»Ÿæ¶æ„

```
ç”¨æˆ·åœ¨ Crisp å‘é€æ¶ˆæ¯
  â†“
Crisp Webhook â†’ crisp-message-hook (Edge Function)
  â†“
æå–æ¶ˆæ¯å†…å®¹ + ä¼šè¯å†å²
  â†“
ç”ŸæˆæŸ¥è¯¢å‘é‡ (OpenAI Embedding)
  â†“
å‘é‡ç›¸ä¼¼åº¦æœç´¢ (pgvector)
  â†“
LLM ç”Ÿæˆå›å¤ (Groq Llama 4)
  â†“
é€šè¿‡ Crisp API è¿”å›ç»™ç”¨æˆ·
```

## åŠŸèƒ½ç‰¹æ€§

### 1. çŸ¥è¯†åº“ç®¡ç†

ç®¡ç†å‘˜å¯ä»¥é€šè¿‡åå°ç®¡ç†ç•Œé¢ä¸Šä¼ å’Œç®¡ç†çŸ¥è¯†å†…å®¹ï¼š

**æ”¯æŒçš„æ–‡ä»¶æ ¼å¼**ï¼š
- æ–‡æœ¬æ–‡ä»¶ï¼ˆ.txt, .mdï¼‰
- æ–‡æ¡£æ–‡ä»¶ï¼ˆ.pdf, .docxï¼‰
- å›¾ç‰‡æ–‡ä»¶ï¼ˆ.jpg, .png, .webpï¼‰

**çŸ¥è¯†åˆ†ç±»**ï¼š
- `rodent_knowledge`ï¼šè€é¼ ç›¸å…³çŸ¥è¯†ï¼ˆä¹ æ€§ã€è¯†åˆ«ã€é˜²æ²»ï¼‰
- `trap_usage`ï¼šæ•é¼ å™¨ä½¿ç”¨çŸ¥è¯†ï¼ˆå®‰è£…ã€å¸ƒæ”¾ã€ç»´æŠ¤ï¼‰
- `faq`ï¼šå¸¸è§é—®é¢˜è§£ç­”

**éšç§çº§åˆ«**ï¼š
- **ğŸ”’ ç§æœ‰ï¼ˆprivateï¼‰**ï¼šä»…å½“å‰ç§Ÿæˆ·å¯è§ï¼Œç”¨äºä¼ä¸šå†…éƒ¨ä¸“æœ‰çŸ¥è¯†
- **ğŸ¢ å†…éƒ¨ï¼ˆinternalï¼‰**ï¼šæ‰€æœ‰ç™»å½•ç”¨æˆ·å¯è§ï¼Œéœ€è¦æƒé™éªŒè¯
- **ğŸŒ å…¬å¼€ï¼ˆpublicï¼‰**ï¼šæ‰€æœ‰äººå¯è§ï¼ŒåŒ…æ‹¬æœªç™»å½•ç”¨æˆ·

### 2. å¤šè¯­è¨€æ”¯æŒ

RAG ç³»ç»Ÿæ”¯æŒå¤šè¯­è¨€çŸ¥è¯†åº“ï¼Œè‡ªåŠ¨è¯†åˆ«ç”¨æˆ·è¯­è¨€å¹¶è¿”å›å¯¹åº”è¯­è¨€çš„çŸ¥è¯†ï¼š

**æ”¯æŒçš„è¯­è¨€**ï¼š
- è‹±è¯­ (en)
- ç®€ä½“ä¸­æ–‡ (zh)
- æ—¥è¯­ (ja)
- è¥¿ç­ç‰™è¯­ (es)
- å¾·è¯­ (de)
- æ³•è¯­ (fr)

**è¯­è¨€è¯†åˆ«æ¥æº**ï¼š
1. Crisp ç”¨æˆ·å…ƒæ•°æ®ï¼ˆ`locales` å­—æ®µï¼‰
2. æµè§ˆå™¨ `Accept-Language` HTTP å¤´
3. ç”¨æˆ·æ¶ˆæ¯ä¸­çš„è¯­è¨€æ ‡è®°

**è¯­è¨€å›é€€æœºåˆ¶**ï¼š
- ä¼˜å…ˆè¿”å›ç”¨æˆ·è¯­è¨€çš„çŸ¥è¯†
- å¦‚æœç”¨æˆ·è¯­è¨€æ— å¯¹åº”çŸ¥è¯†ï¼Œå›é€€åˆ°é»˜è®¤è¯­è¨€ï¼ˆè‹±è¯­ï¼‰
- å¦‚æœè‹±è¯­ä¹Ÿæ— å¯¹åº”çŸ¥è¯†ï¼Œè¿”å›ä¸»è¯­è¨€ç‰ˆæœ¬

### 3. å›¾ç‰‡æ£€ç´¢å’Œè¿”å›

RAG ç³»ç»Ÿæ”¯æŒæ£€ç´¢å¹¶è¿”å›é¢„å…ˆä¸Šä¼ çš„å›¾ç‰‡å†…å®¹ï¼š

**ä½¿ç”¨åœºæ™¯**ï¼š
- ç”¨æˆ·é—®ï¼š"å……ç”µå£åœ¨å“ªé‡Œï¼Ÿ" â†’ ç³»ç»Ÿè¿”å›å……ç”µå£ä½ç½®çš„å®æ‹å›¾ç‰‡
- ç”¨æˆ·é—®ï¼š"å¦‚ä½•å®‰è£…æ•é¼ å™¨ï¼Ÿ" â†’ ç³»ç»Ÿè¿”å›å®‰è£…ç¤ºæ„å›¾
- ç”¨æˆ·é—®ï¼š"è¿™æ˜¯ä»€ä¹ˆå‹å·ï¼Ÿ" â†’ ç³»ç»Ÿè¿”å›äº§å“å¯¹æ¯”å›¾

**æŠ€æœ¯å®ç°**ï¼š
- å›¾ç‰‡ä¸Šä¼ æ—¶ä½¿ç”¨ LLM è§†è§‰ API ç”Ÿæˆè¯¦ç»†çš„æ–‡æœ¬æè¿°
- å°†æè¿°è½¬æ¢ä¸ºå‘é‡åµŒå…¥å­˜å…¥æ•°æ®åº“
- ç”¨æˆ·æŸ¥è¯¢æ—¶ï¼Œé€šè¿‡å‘é‡ç›¸ä¼¼åº¦åŒ¹é…å›¾ç‰‡
- è¿”å›å›¾ç‰‡çš„ Supabase Storage å…¬å¼€é“¾æ¥

### 4. å¼•ç”¨å’Œæ¥æºè¿½æº¯

æ¯ä¸ª AI å›ç­”éƒ½ä¼šé™„å¸¦å¼•ç”¨ä¿¡æ¯ï¼ˆcitationsï¼‰ï¼Œæ ‡æ˜å†…å®¹æ¥æºï¼š

**å¼•ç”¨ä¿¡æ¯åŒ…å«**ï¼š
- çŸ¥è¯†æ ‡é¢˜ï¼ˆ`source_title`ï¼‰
- æ¥æºé“¾æ¥ï¼ˆ`source_url`ï¼‰
- ä½œè€…æˆ–æœºæ„ï¼ˆ`source_author`ï¼‰
- å‘å¸ƒæ—¶é—´ï¼ˆ`source_published_at`ï¼‰
- è®¿é—®æƒé™çº§åˆ«ï¼ˆ`access_level`ï¼‰

**æƒé™éªŒè¯æœºåˆ¶**ï¼š
- å…¬å¼€çŸ¥è¯†ï¼šç›´æ¥å±•ç¤ºåŸå§‹ URL
- å†…éƒ¨/ç§æœ‰çŸ¥è¯†ï¼šé€šè¿‡æƒé™ç½‘å…³ï¼ˆ`/functions/v1/kb-redirect`ï¼‰ä»£ç†è®¿é—®
- ç‚¹å‡»é“¾æ¥æ—¶éªŒè¯ç”¨æˆ·èº«ä»½å’Œæƒé™

### 5. ä¸Šä¸‹æ–‡æ„ŸçŸ¥å¯¹è¯

RAG ç³»ç»Ÿä¼šè®°å¿†ä¼šè¯å†å²ï¼Œæ”¯æŒå¤šè½®å¯¹è¯ï¼š

**ä¼šè¯ç®¡ç†**ï¼š
- æ¯ä¸ª Crisp ä¼šè¯å¯¹åº”ä¸€ä¸ª `conversation_contexts` è®°å½•
- è‡ªåŠ¨å­˜å‚¨æœ€è¿‘ 10 æ¡æ¶ˆæ¯å†å²
- æ”¯æŒç”¨æˆ·å¼•ç”¨ä¹‹å‰çš„å¯¹è¯å†…å®¹ï¼ˆ"åˆšæ‰è¯´çš„..."ã€"ä¸Šé¢é‚£å¼ å›¾..."ï¼‰

**ä¸Šä¸‹æ–‡å¼ºè°ƒ**ï¼š
- æ£€æµ‹ç”¨æˆ·æ˜¯å¦åœ¨å¼ºè°ƒä¹‹å‰çš„å†…å®¹
- ä¼˜å…ˆä»ä¼šè¯å†å²ä¸­æå–ç›¸å…³ä¿¡æ¯
- ç»“åˆå†å²ä¸Šä¸‹æ–‡å’ŒçŸ¥è¯†åº“å†…å®¹ç”Ÿæˆå›ç­”

### 6. å›½å®¶/åœ°åŒºè¿‡æ»¤

çŸ¥è¯†åº“æ”¯æŒæŒ‰å›½å®¶/åœ°åŒºè¿‡æ»¤ï¼Œæä¾›æœ¬åœ°åŒ–å†…å®¹ï¼š

**ä½¿ç”¨åœºæ™¯**ï¼š
- æŸäº›äº§å“ä»…åœ¨ç‰¹å®šå›½å®¶é”€å”®
- æŸäº›æ³•è§„ã€ä½¿ç”¨æŒ‡å—å› åœ°åŒºè€Œå¼‚
- ä¸åŒå›½å®¶çš„ç”¨æˆ·çœ‹åˆ°ä¸åŒçš„æ¨èå†…å®¹

**è¿‡æ»¤è§„åˆ™**ï¼š
- `applicable_countries`ï¼šçŸ¥è¯†é€‚ç”¨çš„å›½å®¶åˆ—è¡¨ï¼ˆä¸ºç©ºè¡¨ç¤ºå…¨å±€ï¼‰
- `excluded_countries`ï¼šæ’é™¤çš„å›½å®¶åˆ—è¡¨ï¼ˆä¼˜å…ˆçº§æ›´é«˜ï¼‰
- æ£€ç´¢æ—¶æ ¹æ®ç”¨æˆ·å›½å®¶/åœ°åŒºè‡ªåŠ¨è¿‡æ»¤

## å‰ç«¯è¾“å…¥

### ç”¨æˆ·é€šè¿‡ Crisp å‘é€æ¶ˆæ¯

ç”¨æˆ·åœ¨ Crisp èŠå¤©çª—å£ä¸­å‘é€æ–‡æœ¬æ¶ˆæ¯ï¼Œæ— éœ€ç‰¹æ®Šæ ¼å¼æˆ–å‚æ•°ã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š

1. æ¥æ”¶ Crisp webhook äº‹ä»¶ï¼ˆ`message:send`ï¼‰
2. æå–æ¶ˆæ¯å†…å®¹å’Œç”¨æˆ·å…ƒæ•°æ®
3. è¯†åˆ«ç”¨æˆ·è¯­è¨€ã€å›½å®¶/åœ°åŒº
4. åŠ è½½ä¼šè¯å†å²ä¸Šä¸‹æ–‡
5. æ‰§è¡Œ RAG æ£€ç´¢å’Œå›ç­”ç”Ÿæˆ
6. é€šè¿‡ Crisp API è¿”å›å›ç­”

**Webhook Payload ç¤ºä¾‹**ï¼š

```json
{
  "website_id": "7ea85f39-a49f-4017-934c-010ed9c9db4d",
  "event": "message:send",
  "timestamp": 1506985696616,
  "data": {
    "session_id": "session_36ba3566-9651-4790-afc8-ffedbccc317f",
    "type": "text",
    "content": "å……ç”µå£åœ¨å“ªé‡Œï¼Ÿ",
    "from": "user",
    "user": {
      "nickname": "visitor493603",
      "locales": ["zh-CN", "en-US"],
      "user_id": "session_36ba3566-9651-4790-afc8-ffedbccc317f"
    },
    "segments": ["china"]
  }
}
```

**å…³é”®å­—æ®µè¯´æ˜**ï¼š
- `data.content`ï¼šç”¨æˆ·çš„é—®é¢˜æ–‡æœ¬ï¼ˆç”¨äº RAG æ£€ç´¢ï¼‰
- `data.user.locales`ï¼šç”¨æˆ·æµè§ˆå™¨è¯­è¨€åå¥½åˆ—è¡¨ï¼ˆç”¨äºè¯­è¨€è¯†åˆ«ï¼‰
- `data.segments`ï¼šç”¨æˆ·åœ°ç†ä½ç½®åˆ†æ®µï¼ˆç”¨äºå›½å®¶/åœ°åŒºè¯†åˆ«ï¼‰
- `data.session_id`ï¼šä¼šè¯ IDï¼ˆç”¨äºåŠ è½½å†å²ä¸Šä¸‹æ–‡ï¼‰

## åç«¯è¾“å‡º

### RAG å›ç­”ç»“æ„

åç«¯ç”Ÿæˆçš„ RAG å›ç­”ä¼šåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

**1. æ–‡æœ¬å›ç­”**

```
æ ¹æ®æ‚¨çš„é—®é¢˜ï¼Œå……ç”µå£ä½äºæ•é¼ å™¨åº•éƒ¨ï¼Œé è¿‘ç”µæºå¼€å…³çš„ä½ç½®ã€‚ä½¿ç”¨é™„å¸¦çš„ USB-C å……ç”µçº¿å³å¯å……ç”µã€‚

[å¼•ç”¨æ¥æº]
ğŸ“„ RatTrap Pro ç”¨æˆ·æ‰‹å†Œ - å……ç”µè¯´æ˜
ğŸ”— https://rattrap.com/kb/charging-guide
```

**2. å›¾ç‰‡è¿”å›**ï¼ˆå¦‚æœæ£€ç´¢åˆ°ç›¸å…³å›¾ç‰‡ï¼‰

```json
{
  "type": "image",
  "url": "https://vwinvkxxheuexvpvzibt.supabase.co/storage/v1/object/public/knowledge-assets/charging-port.jpg",
  "alt": "RatTrap Pro å……ç”µå£ä½ç½®ç¤ºæ„å›¾"
}
```

**3. å¼•ç”¨ä¿¡æ¯ï¼ˆCitationsï¼‰**

```json
{
  "citations": [
    {
      "id": "kb_1a2b3c4d",
      "title": "RatTrap Pro ç”¨æˆ·æ‰‹å†Œ - å……ç”µè¯´æ˜",
      "url": "https://rattrap.com/kb/charging-guide",
      "author": "RatTrap å®˜æ–¹",
      "published_at": "2024-11-15T10:30:00Z",
      "access_level": "public",
      "excerpt": "å……ç”µå£ä½äºæ•é¼ å™¨åº•éƒ¨ï¼Œé è¿‘ç”µæºå¼€å…³..."
    }
  ]
}
```

### é€šè¿‡ Crisp API å‘é€å›å¤

åç«¯ä¼šè°ƒç”¨ Crisp API å°†å›ç­”å‘é€ç»™ç”¨æˆ·ï¼š

```typescript
const response = await fetch(
  `https://api.crisp.chat/v1/website/${websiteId}/conversation/${sessionId}/message`,
  {
    method: 'POST',
    headers: {
      'Authorization': `Basic ${auth}`,
      'Content-Type': 'application/json',
      'X-Crisp-Tier': 'plugin'
    },
    body: JSON.stringify({
      type: 'text',
      from: 'operator',
      origin: 'chat',
      content: aiReply // åŒ…å«æ–‡æœ¬å›ç­” + å¼•ç”¨ä¿¡æ¯
    })
  }
);
```

**å¦‚æœæœ‰å›¾ç‰‡**ï¼š

```typescript
// å…ˆå‘é€å›¾ç‰‡
await sendCrispMessage(websiteId, sessionId, {
  type: 'file',
  from: 'operator',
  content: {
    name: 'charging-port.jpg',
    url: imageUrl,
    type: 'image/jpeg'
  }
});

// å†å‘é€æ–‡æœ¬è¯´æ˜
await sendCrispMessage(websiteId, sessionId, {
  type: 'text',
  from: 'operator',
  content: 'è¿™æ˜¯å……ç”µå£çš„ä½ç½®ç¤ºæ„å›¾ã€‚'
});
```

## æœŸæœ›æ•ˆæœ

### ç”¨æˆ·ä½“éªŒ

1. **å¿«é€Ÿå“åº”**ï¼šç”¨æˆ·å‘é€é—®é¢˜åï¼Œ2-3 ç§’å†…æ”¶åˆ°å›ç­”
2. **å‡†ç¡®åŒ¹é…**ï¼šå›ç­”ä¸é—®é¢˜é«˜åº¦ç›¸å…³ï¼ŒåŒ¹é…åº¦ > 70%
3. **å¤šè¯­è¨€æ— ç¼åˆ‡æ¢**ï¼šè‡ªåŠ¨è¯†åˆ«ç”¨æˆ·è¯­è¨€ï¼Œæ— éœ€æ‰‹åŠ¨åˆ‡æ¢
4. **å¯è§†åŒ–å†…å®¹**ï¼šå¤æ‚é—®é¢˜è¿”å›å›¾ç‰‡è¯´æ˜ï¼Œæ›´ç›´è§‚
5. **å¯è¿½æº¯æ¥æº**ï¼šæ¯ä¸ªå›ç­”éƒ½æœ‰å¼•ç”¨é“¾æ¥ï¼Œæ–¹ä¾¿æ·±åº¦é˜…è¯»

### æŠ€æœ¯æŒ‡æ ‡

- **æ£€ç´¢å‡†ç¡®ç‡**ï¼šTop-5 å¬å›ç‡ > 85%
- **å“åº”æ—¶é—´**ï¼šP95 < 3 ç§’ï¼ˆåŒ…å« LLM ç”Ÿæˆæ—¶é—´ï¼‰
- **å¹¶å‘èƒ½åŠ›**ï¼šæ”¯æŒ 100+ å¹¶å‘ä¼šè¯
- **å¤šè¯­è¨€è¦†ç›–ç‡**ï¼š6 ç§ä¸»è¦è¯­è¨€ï¼ŒçŸ¥è¯†è¦†ç›–ç‡ > 80%
- **å‘é‡æ£€ç´¢æ€§èƒ½**ï¼š10,000 æ¡çŸ¥è¯†åº“ï¼Œæ£€ç´¢æ—¶é—´ < 200ms

### ç¤ºä¾‹å¯¹è¯æµç¨‹

**åœºæ™¯ 1ï¼šç®€å•é—®ç­”**

```
ç”¨æˆ·ï¼šæ•é¼ å™¨æ€ä¹ˆå……ç”µï¼Ÿ

AIï¼šRatTrap Pro ä½¿ç”¨ USB-C æ¥å£å……ç”µã€‚å……ç”µå£ä½äºè®¾å¤‡åº•éƒ¨ï¼Œé è¿‘ç”µæºå¼€å…³ã€‚
å……ç”µæ—¶æŒ‡ç¤ºç¯ä¼šæ˜¾ç¤ºçº¢è‰²ï¼Œå……æ»¡åå˜ä¸ºç»¿è‰²ã€‚å……ç”µæ—¶é—´çº¦ 2-3 å°æ—¶ã€‚

ğŸ“„ æ¥æºï¼šRatTrap Pro ç”¨æˆ·æ‰‹å†Œ
ğŸ”— æŸ¥çœ‹è¯¦æƒ…: https://rattrap.com/kb/charging
```

**åœºæ™¯ 2ï¼šå›¾ç‰‡è¿”å›**

```
ç”¨æˆ·ï¼šå……ç”µå£åœ¨å“ªé‡Œï¼Ÿ

AIï¼š[å‘é€å›¾ç‰‡ï¼šcharging-port.jpg]
å……ç”µå£ä½äºæ•é¼ å™¨åº•éƒ¨ï¼Œå¦‚å›¾æ‰€ç¤ºçš„ä½ç½®ã€‚ä½¿ç”¨é™„å¸¦çš„ USB-C å……ç”µçº¿è¿æ¥å³å¯ã€‚

ğŸ“„ æ¥æºï¼šRatTrap Pro ç”¨æˆ·æ‰‹å†Œ - å……ç”µè¯´æ˜
```

**åœºæ™¯ 3ï¼šå¤šè½®å¯¹è¯**

```
ç”¨æˆ·ï¼šæˆ‘å®¶æœ‰è€é¼ ï¼Œæ€ä¹ˆåŠï¼Ÿ

AIï¼šå»ºè®®é‡‡ç”¨ä»¥ä¸‹æ­¥éª¤ï¼š
1. ç¡®è®¤è€é¼ ç§ç±»ï¼ˆå¤§é¼ è¿˜æ˜¯å°é¼ ï¼‰
2. é€‰æ‹©åˆé€‚çš„æ•é¼ å™¨ç±»å‹
3. åœ¨è€é¼ æ´»åŠ¨åŒºåŸŸå¸ƒæ”¾é™·é˜±
æ‚¨å¯ä»¥æ‹æ‘„è€é¼ ç…§ç‰‡ï¼Œæˆ‘å¸®æ‚¨è¯†åˆ«ç§ç±»ã€‚

---

ç”¨æˆ·ï¼šæ˜¯å¤§è€é¼ 

AIï¼šé’ˆå¯¹å¤§é¼ ï¼Œå»ºè®®ä½¿ç”¨ä»¥ä¸‹ç±»å‹çš„æ•é¼ å™¨ï¼š
1. å¤§å·å¼¹ç°§å¤¹ï¼ˆå‡»æ€ç‡é«˜ï¼‰
2. ç”µå­æ•é¼ å™¨ï¼ˆå®‰å…¨å«ç”Ÿï¼‰
3. å¤§å·ç²˜é¼ æ¿ï¼ˆé€‚åˆå¤šåªæ•è·ï¼‰

æ ¹æ®æ‚¨ä¹‹å‰æåˆ°çš„æƒ…å†µï¼Œæ¨èä½¿ç”¨ RatTrap Pro ç”µå­æ•é¼ å™¨...
```

**åœºæ™¯ 4ï¼šå¼•ç”¨ä¹‹å‰çš„å†…å®¹**

```
ç”¨æˆ·ï¼šåˆšæ‰è¯´çš„ç”µå­æ•é¼ å™¨æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ

AIï¼šæ‚¨åˆšæ‰é—®åˆ°çš„ RatTrap Pro ç”µå­æ•é¼ å™¨æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š
- é«˜å‹ç”µå‡»ï¼Œå‡»æ€ç‡ > 95%
- å®‰å…¨è®¾è®¡ï¼Œé¿å…è¯¯ä¼¤å® ç‰©å’Œå„¿ç«¥
- å¯é‡å¤ä½¿ç”¨ï¼Œæˆæœ¬ä½
- é…å¤‡ LED æŒ‡ç¤ºç¯ï¼Œæ•è·åè‡ªåŠ¨æé†’

ğŸ“„ æ¥æºï¼šRatTrap Pro äº§å“è¯´æ˜
```

## æŠ€æœ¯å®ç°è¦ç‚¹

### å‘é‡åµŒå…¥ç”Ÿæˆ

ä½¿ç”¨ OpenAI `text-embedding-3-small` æ¨¡å‹ï¼š

```typescript
import OpenAI from 'openai';

const openai = new OpenAI({ apiKey: OPENAI_API_KEY });

export async function generateEmbedding(text: string): Promise<number[]> {
  const response = await openai.embeddings.create({
    model: 'text-embedding-3-small',
    input: text,
    encoding_format: 'float',
  });

  return response.data[0].embedding;
}
```

### å‘é‡ç›¸ä¼¼åº¦æœç´¢

ä½¿ç”¨ PostgreSQL + pgvectorï¼š

```sql
SELECT
  id, title, content, image_url, source_url,
  1 - (embedding <=> query_embedding) as similarity
FROM knowledge_base
WHERE is_active = true
  AND 1 - (embedding <=> query_embedding) > 0.7
ORDER BY similarity DESC
LIMIT 5;
```

### LLM å›ç­”ç”Ÿæˆ

ä½¿ç”¨ Groq Llama 4 ç”Ÿæˆå›ç­”ï¼š

```typescript
const systemPrompt = `
ä½ æ˜¯ RatTrap çš„æ™ºèƒ½å®¢æœåŠ©æ‰‹ã€‚æ ¹æ®ä»¥ä¸‹çŸ¥è¯†åº“å†…å®¹å›ç­”ç”¨æˆ·é—®é¢˜ã€‚
å¦‚æœçŸ¥è¯†åº“ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œè¯šå®åœ°å‘Šè¯‰ç”¨æˆ·ã€‚
å›ç­”è¦ç®€æ´ã€å‡†ç¡®ã€å‹å¥½ã€‚

çŸ¥è¯†åº“å†…å®¹ï¼š
${knowledgeContext}
`;

const response = await callLLM({
  prompt: userMessage,
  systemPrompt,
  temperature: 0.7,
  maxTokens: 1000,
});
```

### ä¼šè¯å†å²ç®¡ç†

```typescript
// åŠ è½½ä¼šè¯å†å²
const { data: context } = await supabase
  .from('conversation_contexts')
  .select('messages')
  .eq('session_id', sessionId)
  .single();

// æ·»åŠ æ–°æ¶ˆæ¯
const updatedMessages = [
  ...(context?.messages || []),
  { role: 'user', content: userMessage, timestamp: new Date() },
].slice(-10); // ä¿ç•™æœ€è¿‘ 10 æ¡

// ä¿å­˜å›ä¸Šä¸‹æ–‡
await supabase
  .from('conversation_contexts')
  .upsert({
    session_id: sessionId,
    messages: updatedMessages,
    last_message_at: new Date(),
  });
```

## ç›¸å…³èµ„æº

- **Crisp Message Hook**ï¼š[/crisp-message-hook](/rattrap-api/endpoint/crisp-message-hook) - æ¥æ”¶ Crisp webhook äº‹ä»¶
- **çŸ¥è¯†åº“ç®¡ç†ç•Œé¢**ï¼šAdmin Portal â†’ çŸ¥è¯†åº“ç®¡ç†
- **æŠ€æœ¯æ–¹æ¡ˆæ–‡æ¡£**ï¼š`RAG_KNOWLEDGE_BASE_DESIGN.md`
