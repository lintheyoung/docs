---
title: '删除知识库文件'
openapi: 'DELETE /knowledge-base/{id}'
---

<RequestExample>
```bash cURL
curl -X DELETE https://lrsppxarhxvxcflougbp.supabase.co/functions/v1/knowledge-base/kb_1a2b3c4d5e6f7g8h \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJhdXRoZW50aWNhdGVkIiwiZXhwIjoxNzMyNjE4MDAwLCJpYXQiOjE3MzI2MTQ0MDAsImlzcyI6Imh0dHBzOi8vbHJzcHB4YXJoeHZ4Y2Zsb3VnYnAuc3VwYWJhc2UuY28iLCJzdWIiOiJ1c2VyLWlkLWhlcmUifQ.xxx"
```

```javascript Node.js
const response = await fetch(
  "https://lrsppxarhxvxcflougbp.supabase.co/functions/v1/knowledge-base/kb_1a2b3c4d5e6f7g8h",
  {
    method: "DELETE",
    headers: {
      "Authorization": `Bearer ${accessToken}`,
    },
  }
);

if (response.status === 204) {
  console.log("知识已成功删除");
} else {
  const error = await response.json();
  console.error(`删除失败: ${error.error.message}`);
}
```

```python Python
import requests

response = requests.delete(
    "https://lrsppxarhxvxcflougbp.supabase.co/functions/v1/knowledge-base/kb_1a2b3c4d5e6f7g8h",
    headers={
        "Authorization": f"Bearer {access_token}",
    }
)

if response.status_code == 204:
    print("知识已成功删除")
else:
    error = response.json()
    print(f"删除失败: {error['error']['message']}")
```
</RequestExample>

<ResponseExample>
```json 成功响应
// HTTP 204 No Content
// 无响应体
```

```json 成功响应（带确认信息）
{
  "success": true,
  "message": "Knowledge entry deleted successfully",
  "deleted_id": "kb_1a2b3c4d5e6f7g8h",
  "deleted_translations": 3
}
```

```json 错误响应 - 未授权
{
  "error": {
    "type": "authentication_error",
    "code": "UNAUTHORIZED",
    "message": "Invalid or missing authentication token",
    "doc_url": "https://docs.rattrap.ai/errors#unauthorized"
  }
}
```

```json 错误响应 - 权限不足
{
  "error": {
    "type": "permission_error",
    "code": "FORBIDDEN",
    "message": "Unauthorized. Admin role required.",
    "doc_url": "https://docs.rattrap.ai/errors#forbidden"
  }
}
```

```json 错误响应 - 知识不存在
{
  "error": {
    "type": "not_found_error",
    "code": "NOT_FOUND",
    "message": "Knowledge entry not found",
    "param": "id",
    "doc_url": "https://docs.rattrap.ai/errors#not_found"
  }
}
```
</ResponseExample>

## 使用说明

管理员可以通过此接口删除知识库中的条目。删除操作是**不可逆**的，请谨慎操作。

<CardGroup cols={3}>
  <Card title="级联删除" icon="trash">
    自动删除关联的翻译版本和存储文件
  </Card>
  <Card title="权限验证" icon="shield">
    仅管理员和所有者可执行删除操作
  </Card>
  <Card title="软删除选项" icon="eye-slash">
    可通过 PATCH 接口设置 is_active=false 实现软删除
  </Card>
</CardGroup>

<Warning>
**权限要求**：此接口仅限 **管理员（admin）** 或 **所有者（owner）** 角色使用。
</Warning>

## 请求参数

### 路径参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `id` | string | 是 | 知识库条目 ID，格式：`kb_xxx` |

## 删除行为

当删除一个知识条目时，系统会执行以下操作：

<Steps>
  <Step title="权限验证">
    验证用户身份和角色，确认具有管理员权限。
  </Step>
  <Step title="检查知识存在">
    查询数据库确认知识条目存在，且用户有权删除（同租户或全局管理员）。
  </Step>
  <Step title="删除关联翻译">
    级联删除 `knowledge_translations` 表中该知识的所有翻译版本。
  </Step>
  <Step title="删除存储文件">
    如果是图片类型，从 Supabase Storage 删除对应的图片文件。
  </Step>
  <Step title="删除主记录">
    从 `knowledge_base` 表删除知识条目记录。
  </Step>
</Steps>

## 软删除 vs 硬删除

<Info>
**推荐做法**：如果只是想临时禁用某个知识条目，建议使用软删除而非硬删除。
</Info>

### 软删除（推荐）

使用 PATCH 接口将 `is_active` 设置为 `false`：

```bash
curl -X PATCH https://lrsppxarhxvxcflougbp.supabase.co/functions/v1/knowledge-base/kb_1a2b3c4d5e6f7g8h \
  -H "Authorization: Bearer ${accessToken}" \
  -H "Content-Type: application/json" \
  -d '{"is_active": false}'
```

软删除的优点：
- 知识不会出现在 RAG 检索结果中
- 保留历史数据，随时可以恢复
- 保留使用统计和审计日志

### 硬删除（本接口）

使用 DELETE 接口永久删除：
- 数据库记录完全删除
- 关联翻译和存储文件一并删除
- **不可恢复**

## 响应字段说明

成功删除时返回 HTTP 204 No Content，或返回确认信息：

| 字段 | 类型 | 说明 |
|------|------|------|
| `success` | boolean | 操作是否成功 |
| `message` | string | 操作结果描述 |
| `deleted_id` | string | 被删除的知识条目 ID |
| `deleted_translations` | integer | 级联删除的翻译版本数量 |

## 错误码

| HTTP 状态码 | 错误代码 | 说明 |
|-----------|---------|------|
| 401 | `UNAUTHORIZED` | 未提供有效的认证 Token |
| 403 | `FORBIDDEN` | 当前用户不是管理员，无权删除知识 |
| 404 | `NOT_FOUND` | 知识条目不存在或已被删除 |
| 500 | `INTERNAL_ERROR` | 服务器内部错误 |

## 使用注意事项

<Warning>
**不可逆操作**：
- 删除操作无法撤销
- 所有关联的翻译版本将被一并删除
- 存储的图片文件也会被删除
- 建议在删除前先导出或备份重要知识
</Warning>

<Info>
**审计日志**：
删除操作会记录在系统审计日志中，包括：
- 操作者 ID
- 操作时间
- 被删除知识的 ID 和标题
</Info>

## 常见问题

<AccordionGroup>
  <Accordion title="删除后能恢复吗？">
    不能。DELETE 操作是永久删除，无法恢复。如果需要临时禁用知识，请使用软删除（设置 `is_active=false`）。
  </Accordion>

  <Accordion title="删除知识会影响历史问答记录吗？">
    不会影响已保存的问答记录。但被删除的知识将不再出现在新的 RAG 检索结果中。
  </Accordion>

  <Accordion title="如何批量删除知识？">
    目前不支持批量删除 API。如需批量删除，请循环调用单条删除接口，或联系系统管理员进行数据库操作。
  </Accordion>

  <Accordion title="普通用户可以删除自己上传的知识吗？">
    不可以。删除操作仅限管理员（admin）和所有者（owner）角色。这是为了防止重要知识被意外删除。
  </Accordion>

  <Accordion title="删除 public 知识需要什么权限？">
    删除 `visibility='public'` 的知识需要系统管理员权限，普通租户管理员只能删除本租户的私有知识。
  </Accordion>
</AccordionGroup>

## 相关资源

- **上传知识库文件**：[/knowledge-upload](/rattrap-api/endpoint/knowledge-upload) - 上传新的知识条目
- **获取知识库文件**：[/knowledge-base/{id}](/rattrap-api/endpoint/get-knowledge) - 获取知识条目详情
- **RAG 知识问答系统**：[/rag-qa](/rattrap-api/endpoint/rag-qa) - 查询知识库并生成回答
