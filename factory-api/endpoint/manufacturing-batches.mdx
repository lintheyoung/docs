---
title: '查询生产批次'
api: 'GET /manufacturing-batches'
---

## 接口说明

查询设备生产批次记录，支持分页和筛选。仅管理员可访问。

## 查询参数

<ParamField query="page" type="number" default="1">
  页码，从1开始
</ParamField>

<ParamField query="limit" type="number" default="20">
  每页数量，范围: 1-100
</ParamField>

<ParamField query="device_type" type="string">
  按设备类型筛选，获取某类设备的所有批次
  - `gateway`: 网关设备
  - `vibration_sensor`: 震动检测传感器
  - `smart_trap`: 智能捕鼠器
  - `temp_humidity_sensor`: 温湿度传感器
  - `pir_sensor`: 红外人体传感器
</ParamField>

<ParamField query="model" type="string">
  按设备型号筛选，例如: `RT-Gateway-Pro`, `SmartTrap-v2`
</ParamField>

<ParamField query="status" type="string">
  按批次状态筛选
  - `completed`: 已完成
  - `partial`: 部分失败
  - `failed`: 全部失败
</ParamField>

<ParamField query="batch_id" type="string">
  按批次ID精确查询
</ParamField>

## 响应数据

<ResponseField name="batches" type="array">
  批次列表

  <Expandable title="Batch 对象">
    <ResponseField name="batch_id" type="string">
      批次ID
    </ResponseField>

    <ResponseField name="batch_name" type="string">
      批次名称
    </ResponseField>

    <ResponseField name="device_type" type="string">
      设备类型: `gateway` | `vibration_sensor` | `smart_trap` | `temp_humidity_sensor` | `pir_sensor`
    </ResponseField>

    <ResponseField name="model" type="string">
      设备型号
    </ResponseField>

    <ResponseField name="requested_count" type="number">
      请求创建数量
    </ResponseField>

    <ResponseField name="created_count" type="number">
      实际创建数量
    </ResponseField>

    <ResponseField name="status" type="string">
      批次状态: `completed` | `partial` | `failed`
    </ResponseField>

    <ResponseField name="created_at" type="string">
      创建时间 (ISO 8601)
    </ResponseField>

    <ResponseField name="created_by" type="string">
      创建者用户ID
    </ResponseField>

    <ResponseField name="metadata" type="object">
      批次元数据（自定义字段）
    </ResponseField>
  </Expandable>
</ResponseField>

<ResponseField name="pagination" type="object">
  分页信息

  <Expandable title="Pagination">
    <ResponseField name="page" type="number">
      当前页码
    </ResponseField>

    <ResponseField name="limit" type="number">
      每页数量
    </ResponseField>

    <ResponseField name="total" type="number">
      总记录数
    </ResponseField>

    <ResponseField name="total_pages" type="number">
      总页数
    </ResponseField>
  </Expandable>
</ResponseField>

## 错误码

| 错误码 | HTTP状态码 | 说明 |
|--------|-----------|------|
| `UNAUTHORIZED` | 401 | 缺少或无效的认证Token |
| `PERMISSION_DENIED` | 403 | 非管理员用户无权访问 |
| `INVALID_PARAMETERS` | 400 | 参数验证失败 |
| `DATABASE_ERROR` | 500 | 数据库查询失败 |

<RequestExample>
```bash cURL - 查询所有网关批次
curl -X GET \
  'https://your-supabase-project.supabase.co/functions/v1/manufacturing-batches?device_type=gateway&page=1&limit=20' \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"
```

```bash cURL - 按型号筛选
curl -X GET \
  'https://your-supabase-project.supabase.co/functions/v1/manufacturing-batches?model=RT-Gateway-Pro&page=1&limit=20' \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"
```

```javascript Node.js - 查询所有智能捕鼠器批次
const response = await fetch(
  'https://your-supabase-project.supabase.co/functions/v1/manufacturing-batches?device_type=smart_trap&page=1&limit=20',
  {
    method: 'GET',
    headers: {
      'Authorization': 'Bearer YOUR_ADMIN_TOKEN'
    }
  }
);

const data = await response.json();
console.log(`Found ${data.pagination.total} smart trap batches`);
```

```python Python - 查询所有网关批次
import requests

response = requests.get(
    'https://your-supabase-project.supabase.co/functions/v1/manufacturing-batches',
    headers={'Authorization': 'Bearer YOUR_ADMIN_TOKEN'},
    params={
        'device_type': 'gateway',
        'page': 1,
        'limit': 20
    }
)

data = response.json()
print(f"Found {data['pagination']['total']} gateway batches")
```
</RequestExample>

<ResponseExample>
```json 成功响应 - 查询所有网关批次
{
  "batches": [
    {
      "batch_id": "batch_1702900000",
      "batch_name": "Gateway Production Batch 2024-Q1",
      "device_type": "gateway",
      "model": "RT-Gateway-Pro",
      "requested_count": 100,
      "created_count": 100,
      "status": "completed",
      "created_at": "2024-12-18T10:00:00Z",
      "created_by": "d9e3f5c1-4e0a-4b5e-8f3a-1c2d3e4f5a6b",
      "metadata": {
        "production_line": "Line A",
        "firmware_version": "v2.1.0"
      }
    },
    {
      "batch_id": "batch_1702800000",
      "batch_name": "Gateway Test Batch",
      "device_type": "gateway",
      "model": "RT-Gateway-Pro",
      "requested_count": 10,
      "created_count": 8,
      "status": "partial",
      "created_at": "2024-12-17T15:30:00Z",
      "created_by": "d9e3f5c1-4e0a-4b5e-8f3a-1c2d3e4f5a6b",
      "metadata": {}
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 45,
    "total_pages": 3
  }
}
```

```json 错误响应 - 权限不足
{
  "error": {
    "code": "PERMISSION_DENIED",
    "message": "Admin role required",
    "statusCode": 403
  }
}
```

```json 错误响应 - 参数错误
{
  "error": {
    "code": "INVALID_PARAMETERS",
    "message": "limit must be between 1 and 100",
    "statusCode": 400
  }
}
```
</ResponseExample>

## 使用说明

### 权限要求
- 调用者必须拥有 **Admin** 角色

### 筛选示例

<CodeGroup>
```bash 按设备类型筛选 - 获取所有网关批次
curl -X GET \
  'https://your-project.supabase.co/functions/v1/manufacturing-batches?device_type=gateway' \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"
```

```bash 按设备类型筛选 - 获取所有智能捕鼠器批次
curl -X GET \
  'https://your-project.supabase.co/functions/v1/manufacturing-batches?device_type=smart_trap' \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"
```

```bash 按型号筛选
curl -X GET \
  'https://your-project.supabase.co/functions/v1/manufacturing-batches?model=RT-Gateway-Pro' \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"
```

```bash 按状态筛选
curl -X GET \
  'https://your-project.supabase.co/functions/v1/manufacturing-batches?status=completed' \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"
```

```bash 组合筛选 - 获取所有已完成的网关批次
curl -X GET \
  'https://your-project.supabase.co/functions/v1/manufacturing-batches?device_type=gateway&status=completed' \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"
```

```bash 查询特定批次
curl -X GET \
  'https://your-project.supabase.co/functions/v1/manufacturing-batches?batch_id=batch_1702900000' \
  -H "Authorization: Bearer YOUR_ADMIN_TOKEN"
```
</CodeGroup>

### 状态说明

| 状态 | 说明 |
|------|------|
| `completed` | 请求的设备数量全部创建成功 |
| `partial` | 部分设备创建成功，部分失败 |
| `failed` | 所有设备创建失败 |

<Note>
批次记录永久保存，用于设备溯源和生产审计。
</Note>
